<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Relat√≥rio de Vistoria T√©cnica - ERCBA</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    :root {
      --primary-color: #003366;
      --secondary-color: #0056b3;
      --accent-color: #28a745;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
      padding: 20px 10px;
    }

    .form-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 30px;
      background: white;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }

    .header-logo {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      margin-bottom: 10px;
      padding-bottom: 15px;
      border-bottom: 3px solid var(--primary-color);
    }

    .logo-placeholder {
      width: 100px;
      height: 100px;
      background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 14px;
      text-align: center;
      padding: 10px;
    }

    .header-text {
      text-align: center;
      flex-grow: 1;
    }

    .header-text h3 {
      color: var(--primary-color);
      font-weight: 700;
      margin-bottom: 5px;
      font-size: 24px;
    }

    .header-text h4 {
      color: var(--secondary-color);
      font-weight: 600;
      margin-bottom: 10px;
      font-size: 20px;
    }

    .header-text h5 {
      color: #333;
      font-weight: 500;
      background: #e9ecef;
      padding: 8px 15px;
      border-radius: 5px;
      display: inline-block;
      font-size: 18px;
    }

    .form-section {
      margin: 30px 0;
      background: #f8f9fa;
      padding: 20px;
      border-radius: 10px;
      border-left: 5px solid var(--primary-color);
    }

    .section-title {
      color: var(--primary-color);
      font-weight: 700;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px dashed #dee2e6;
      font-size: 18px;
    }

    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 25px;
    }

    .info-item {
      background: white;
      padding: 15px;
      border-radius: 8px;
      border: 1px solid #dee2e6;
    }

    .info-item label {
      font-weight: 600;
      color: #495057;
      margin-bottom: 5px;
      display: block;
      font-size: 14px;
    }

    .info-item input {
      border: 2px solid #e9ecef;
      border-radius: 5px;
      padding: 10px;
      width: 100%;
      transition: all 0.3s;
      font-size: 15px;
    }

    .info-item input:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(0, 51, 102, 0.1);
      outline: none;
    }

    .table-responsive {
      background: white;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    }

    .custom-table {
      width: 100%;
      margin-bottom: 0;
    }

    .custom-table thead th {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
      font-weight: 600;
      padding: 15px;
      border: none;
      text-align: center;
      vertical-align: middle;
    }

    .custom-table tbody td {
      padding: 15px;
      vertical-align: middle;
      border: 1px solid #dee2e6;
    }

    .condicionante-cell {
      min-width: 450px;
    }

    .radio-group {
      display: flex;
      justify-content: center;
      gap: 25px;
    }

    .radio-option {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
    }

    .radio-option input[type="radio"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
    }

    .radio-option label {
      margin: 0;
      cursor: pointer;
      font-weight: 500;
    }

    .empty-row {
      background: #f8f9fa;
    }

    .empty-row input {
      border: 1px dashed #adb5bd;
      background: transparent;
      padding: 8px;
      width: 100%;
      border-radius: 4px;
    }

    .observacoes-container {
      background: white;
      padding: 20px;
      border-radius: 8px;
      border: 1px solid #dee2e6;
    }

    .observacoes-container textarea {
      width: 100%;
      min-height: 120px;
      border: 2px solid #e9ecef;
      border-radius: 5px;
      padding: 15px;
      font-size: 15px;
      resize: vertical;
    }

    .observacoes-container textarea:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(0, 51, 102, 0.1);
      outline: none;
    }

    .assinatura-container {
      background: white;
      padding: 25px;
      border-radius: 10px;
      border: 2px solid #dee2e6;
      margin-top: 30px;
    }

    .assinatura-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 25px;
    }

    .assinatura-line {
      height: 2px;
      background: #333;
      margin-top: 40px;
      position: relative;
    }

    .assinatura-text {
      position: absolute;
      top: -25px;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      padding: 0 15px;
      font-weight: 500;
      color: #666;
    }

    .btn-group-custom {
      display: flex;
      gap: 12px;
      justify-content: center;
      margin-top: 40px;
      flex-wrap: wrap;
    }

    .btn-custom {
      padding: 12px 25px;
      border-radius: 8px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
      transition: all 0.3s;
      border: none;
      cursor: pointer;
    }

    .btn-save {
      background: linear-gradient(135deg, var(--accent-color), #20c997);
      color: white;
    }

    .btn-save:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
    }

    .btn-load {
      background: linear-gradient(135deg, #17a2b8, #138496);
      color: white;
    }

    .btn-load:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(23, 162, 184, 0.3);
    }

    .btn-pdf {
      background: linear-gradient(135deg, #dc3545, #c82333);
      color: white;
    }

    .btn-pdf:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(220, 53, 69, 0.3);
    }

    .btn-clear {
      background: linear-gradient(135deg, #6c757d, #5a6268);
      color: white;
    }

    .btn-clear:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(108, 117, 125, 0.3);
    }

    .btn-print {
      background: linear-gradient(135deg, #ffc107, #e0a800);
      color: #212529;
    }

    .btn-print:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(255, 193, 7, 0.3);
    }

    .status-bar {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: var(--accent-color);
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      display: none;
      z-index: 1000;
    }

    @media print {
      .no-print {
        display: none !important;
      }

      body {
        background: white;
        padding: 0;
      }

      .form-container {
        box-shadow: none;
        padding: 0;
        margin: 0;
      }

      .table-responsive {
        box-shadow: none;
        break-inside: avoid;
      }

      .form-section {
        break-inside: avoid;
      }
    }

    @media (max-width: 768px) {
      .form-container {
        padding: 15px;
      }

      .header-logo {
        flex-direction: column;
        gap: 10px;
      }

      .assinatura-grid {
        grid-template-columns: 1fr;
        gap: 15px;
      }

      .btn-custom {
        padding: 10px 15px;
        font-size: 14px;
      }

      .info-grid {
        grid-template-columns: 1fr;
      }
    }

    .footer-note {
      text-align: center;
      margin-top: 20px;
      padding-top: 15px;
      border-top: 1px solid #dee2e6;
      color: #666;
      font-size: 14px;
    }

    .relatorio-info {
      text-align: center;
      margin-bottom: 25px;
    }

    .relatorio-titulo {
      color: var(--primary-color);
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 5px;
    }

    .relatorio-subtitulo {
      color: var(--secondary-color);
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 10px;
    }

    .relatorio-nome {
      color: #333;
      font-weight: 500;
      background: #e9ecef;
      padding: 10px 20px;
      border-radius: 8px;
      display: inline-block;
      font-size: 18px;
      margin-bottom: 15px;
    }

    .relatorio-sistema {
      font-style: italic;
      color: #666;
      font-size: 14px;
      margin-top: 5px;
    }
  </style>
</head>

<body>

  <div class="relatorio-info">
    <h3 class="relatorio-titulo">ESCRIT√ìRIO REGIONAL DE CURITIBA</h3>
    <h4 class="relatorio-subtitulo">SETOR DE LICENCIAMENTO DE ENERGIA</h4>
    <div class="relatorio-nome">RELAT√ìRIO DE VISTORIA T√âCNICA</div>
  </div>

  <form id="formularioVistoria" onsubmit="event.preventDefault();">
    <div class="info-grid">
      <div class="info-item">
        <label for="empreendimento">EMPREENDIMENTO:</label>
        <input type="text" id="empreendimento" placeholder="Nome do empreendimento" required>
      </div>
      <div class="info-item">
        <label for="protocolo">PROTOCOLO:</label>
        <input type="text" id="protocolo" placeholder="N√∫mero do protocolo" required>
      </div>
      <div class="info-item">
        <label for="dataVistoria">DATA:</label>
        <input type="date" id="dataVistoria" required>
      </div>
    </div>

    <div class="form-section">
      <div class="section-title">1. ATENDIMENTO √ÄS CONDICIONANTES:</div>
      <div class="table-responsive">
        <table class="table custom-table">
          <thead>
            <tr>
              <th width="65%">CONDICIONANTES</th>
              <th width="35%">ATENDE</th>
            </tr>
          </thead>
          <tbody id="condicionantes-body"></tbody>
        </table>
      </div>
    </div>

    <div class="form-section">
      <div class="section-title">2. RELAT√ìRIO DE CONFORMIDADE:</div>
      <div class="table-responsive">
        <table class="table custom-table">
          <thead>
            <tr>
              <th width="65%">CHECK-LIST IN-LOCO</th>
              <th width="35%">ATENDE</th>
            </tr>
          </thead>
          <tbody id="checklist-body"></tbody>
        </table>
      </div>
    </div>

    <div class="form-section">
      <div class="section-title">OBSERVA√á√ïES ADICIONAIS:</div>
      <div class="observacoes-container">
        <textarea id="observacoes" placeholder="Digite observa√ß√µes adicionais sobre a vistoria..."></textarea>
      </div>
    </div>

    <div class="assinatura-container">
      <div class="assinatura-grid">
        <div class="info-item">
          <label for="vistoriador">VISTORIADOR:</label>
          <input type="text" id="vistoriador" placeholder="Nome do vistoriador" required>
        </div>
        <div class="info-item">
          <label for="cargo">CARGO:</label>
          <input type="text" id="cargo" value="Engenheiro/Respons√°vel T√©cnico" required>
        </div>
      </div>
      <div class="assinatura-line">
        <div class="assinatura-text">ASSINATURA</div>
      </div>
    </div>

    <div class="footer-note">
      <p>Este relat√≥rio deve ser preenchido com base na vistoria t√©cnica realizada no local.</p>
    </div>

    <div class="btn-group-custom no-print">
      <button type="button" class="btn-custom btn-save" onclick="salvarFormulario()">
        üíæ Salvar
      </button>
      <button type="button" class="btn-custom btn-load" onclick="carregarFormulario()">
        üìÇ Carregar
      </button>
      <button type="button" class="btn-custom btn-pdf" onclick="gerarPDF()">
        üìÑ Gerar PDF
      </button>
      <button type="button" class="btn-custom btn-clear" onclick="limparFormulario()">
        üóëÔ∏è Limpar
      </button>
      <button type="button" class="btn-custom btn-print" onclick="window.print()">
        üñ®Ô∏è Imprimir
      </button>
    </div>
  </form>
  </div>
  </div>

  <div class="status-bar" id="statusBar"></div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // ============================================
    // CONFIGURA√á√ïES FIXAS DO PDF
    // ============================================
    const PDF_CONFIG = {
      relatorioText: {
        linha1: "ESCRIT√ìRIO REGIONAL DE CURITIBA",
        linha2: "SETOR DE LICENCIAMENTO DE ENERGIA",
        linha3: "RELAT√ìRIO DE VISTORIA T√âCNICA"
      },
      footerText: {
        linha1: "IAT - Instituto √Ågua e Terra",
        linha2: "Rua Presidente Faria, 123 - Centro - Curitiba/PR",
        linha3: "CEP: 80000-000 | Tel: (41) 3210-1000"
      },
      colors: {
        primary: [0, 51, 102],
        secondary: [0, 86, 179],
        lightGray: [240, 240, 240],
        darkGray: [100, 100, 100]
      },
      pageWidth: 210,
      marginLeft: 20,
      marginRight: 20
    };
    // ============================================
    // LOGOS FIXAS - SUBSTITUA ESTAS STRINGS BASE64
    // PELAS SUAS LOGOS REAIS
    // ============================================
    const LOGOS = {
      // Logo ERCBA (esquerda) - substitua pela sua logo em Base64
      headerLeft: "https://upload.wikimedia.org/wikipedia/pt/b/ba/Logo_IAT_PR.png",
      // Logo IAT (direita) - substitua pela sua logo em Base64
      headerRight: "https://i.postimg.cc/8CbcrCB9/dynamiccontent-properties.png",
      // Logo do rodap√© - substitua pela sua logo em Base64
      // Agora uma linha horizontal simples em SVG
      footerLogo: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABHgAAAAmCAYAAAC/OSzXAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAKMSURBVHhe7djBi81RGMfhW5aztp6FnaWttQ027OxGNlI2srBCsWBlymbIcpiIlDKlpm4mUYaxMqNmJJdpUtNMtxBx/XR1aHAW5tx+l9d9nvr8C+e8fRsVAAAAAKEZeAAAAACCM/AAAAAABGfgAQAAAAjOwAMAAAAQnIEHAAAAIDgDDwAAAEBwBh4AAACA4Aw8AAAAAMEZeAAAAACCM/AAAAAABGfgAQAAAAjut4Fn/s07SZIkSQX1an7tlSRJP9qInwaepfaHqnFkSpIkSdIGuz23kq7qMktvV6qhS3urxthOSZKqXZMn0g/xZww8kiRJUo+NTDxNF3W5/c1z2QNfkjSYGXgkSZKkPjZ0rPntju7FZGsme9xLkgY3A48kSZLUx0anW+maLrft+uHscS9JGtwMPJIkSVKf2n5+Jl3S5c48uZY97CVJg52BR5IkSepTzcXVdEmXed5erjZd2J097CVJg52BR5IkSepDh248S1d0uX1TZ7NHvSRJBh5JkiSp5jYfn67W3n9KV3SZmy/uZw96SZK6GXgkSZKkmrv44HW6oMttvXowe9BLktTNwCNJkiTV2I6x2XQ9lzv56HL2mJck6XsGHkmSJKnGHr5sp+u5zNxqK3vIS5K0PgOPJEmSVFNHby2ky7ncnjuns4e8JEnrM/BIkiRJNTR86l718XMnXc5lJhbuZo94SZJ+7Z8aeLqfoCRJkvS3yt2opY0/Xk5Xc5nOl0615cqB7BGfa3h8RJL0H5Z783P1NPAAAAAAEI+BBwAAACA4Aw8AAABAcAYeAAAAgOAMPAAAAADBGXgAAAAAgjPwAAAAAARn4AEAAAAIzsADAAAAEJyBBwAAACA4Aw8AAABAaFX1FQZy/v1IobicAAAAAElFTkSuQmCC"
    };
    // ============================================
    // DADOS DO FORMUL√ÅRIO
    // ============================================
    const condicionantes = [
      "O esgoto sanit√°rio dever√° ser encaminhado para a fossa s√©ptica e semidouro ou para rede coletora p√∫blica.",
      "Disposi√ß√£o e destina√ß√£o adequadas dos res√≠duos s√≥lidos e l√≠quidos.",
      "",
      "",
      "",
      "",
      ""
    ];
    const checklistItems = [
      "Alvar√° de funcionamento",
      "Licen√ßa de Opera√ß√£o vigente",
      "Plano de Atendimento a Emerg√™ncias",
      "FISPQ's ficha de inspe√ß√£o de seguran√ßa de produtos qu√≠micos",
      "Ilumina√ß√£o antifa√≠sca em funcionamento",
      "Sinaliza√ß√£o de advert√™ncia de obrigatoriedade ao uso de EPI's",
      "Sinaliza√ß√£o de alerta de perigo e restri√ß√£o de entrada a pessoas autorizadas",
      "Sinaliza√ß√£o de seguran√ßa para manobra de ve√≠culos",
      "Validade dos extintores",
      "Mapa de risco",
      "Ind√≠cio de vazamento de √≥leo sob os transformadores",
      "Exist√™ncia de filme de √≥leo no sistema SAO*",
      "Avarias nas tampas do SAO* (infiltra√ß√£o de √°gua pluvial pelas tampas)",
      "Necessidade de limpeza das canaletas",
      "Ind√≠cios de contamina√ß√£o do solo",
      "Bacia de Conten√ß√£o",
      "Exist√™ncia de ind√≠cios de processos erosivos",
      "Necessidade limpeza (exist√™ncia de lixo/materiais de manuten√ß√£o a recolher)",
      "Necessidade de manuten√ß√£o da vegeta√ß√£o"
    ];
    // ============================================
    // INICIALIZA√á√ÉO
    // ============================================
    document.addEventListener('DOMContentLoaded', function() {
      const hoje = new Date().toISOString().split('T')[0];
      document.getElementById('dataVistoria').value = hoje;
      preencherCondicionantes();
      preencherChecklist();
      setTimeout(() => {
        carregarFormulario();
      }, 500);
    });

    function preencherCondicionantes() {
      const condicionantesBody = document.getElementById('condicionantes-body');
      condicionantesBody.innerHTML = '';
      condicionantes.forEach((cond, index) => {
        const row = document.createElement('tr');
        if (cond === "") {
          row.className = 'empty-row';
          row.innerHTML = `
                        <td>
                            <input type="text" class="form-control" 
                                   placeholder="Digite a condicionante" 
                                   id="cond_custom_${index}">
                        </td>
                        <td>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" name="cond_${index}" value="sim" id="cond_sim_${index}">
                                    <label for="cond_sim_${index}">SIM</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" name="cond_${index}" value="nao" id="cond_nao_${index}">
                                    <label for="cond_nao_${index}">N√ÉO</label>
                                </div>
                            </div>
                        </td>
                    `;
        } else {
          row.innerHTML = `
                        <td class="condicionante-cell">${cond}</td>
                        <td>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" name="cond_${index}" value="sim" id="cond_sim_${index}">
                                    <label for="cond_sim_${index}">SIM</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" name="cond_${index}" value="nao" id="cond_nao_${index}">
                                    <label for="cond_nao_${index}">N√ÉO</label>
                                </div>
                            </div>
                        </td>
                    `;
        }
        condicionantesBody.appendChild(row);
      });
    }

    function preencherChecklist() {
      const checklistBody = document.getElementById('checklist-body');
      checklistBody.innerHTML = '';
      checklistItems.forEach((item, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `
                    <td class="condicionante-cell">${item}</td>
                    <td>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" name="check_${index}" value="sim" id="check_sim_${index}">
                                <label for="check_sim_${index}">SIM</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" name="check_${index}" value="nao" id="check_nao_${index}">
                                <label for="check_nao_${index}">N√ÉO</label>
                            </div>
                        </div>
                    </td>
                `;
        checklistBody.appendChild(row);
      });
    }
    // ============================================
    // FUN√á√ïES PRINCIPAIS DO FORMUL√ÅRIO
    // ============================================
    function salvarFormulario() {
      const dados = {
        empreendimento: document.getElementById('empreendimento').value,
        protocolo: document.getElementById('protocolo').value,
        dataVistoria: document.getElementById('dataVistoria').value,
        observacoes: document.getElementById('observacoes').value,
        vistoriador: document.getElementById('vistoriador').value,
        cargo: document.getElementById('cargo').value,
        condicionantes: [],
        checklist: []
      };
      for (let i = 0; i < condicionantes.length; i++) {
        const condCustom = document.getElementById(`cond_custom_${i}`);
        const condValue = condCustom ? condCustom.value : condicionantes[i];
        const radioValue = document.querySelector(`input[name="cond_${i}"]:checked`)?.value;
        dados.condicionantes.push({
          texto: condValue,
          atende: radioValue
        });
      }
      for (let i = 0; i < checklistItems.length; i++) {
        const radioValue = document.querySelector(`input[name="check_${i}"]:checked`)?.value;
        dados.checklist.push({
          item: checklistItems[i],
          atende: radioValue
        });
      }
      localStorage.setItem('relatorioVistoria', JSON.stringify(dados));
      mostrarStatus('Formul√°rio salvo localmente!');
    }

    function carregarFormulario() {
      const dadosSalvos = localStorage.getItem('relatorioVistoria');
      if (!dadosSalvos) {
        mostrarStatus('Nenhum dado salvo encontrado.', 'info');
        return;
      }
      try {
        const dados = JSON.parse(dadosSalvos);
        document.getElementById('empreendimento').value = dados.empreendimento || '';
        document.getElementById('protocolo').value = dados.protocolo || '';
        document.getElementById('dataVistoria').value = dados.dataVistoria || '';
        document.getElementById('observacoes').value = dados.observacoes || '';
        document.getElementById('vistoriador').value = dados.vistoriador || '';
        document.getElementById('cargo').value = dados.cargo || 'Engenheiro/Respons√°vel T√©cnico';
        if (dados.condicionantes) {
          dados.condicionantes.forEach((cond, index) => {
            const condCustom = document.getElementById(`cond_custom_${index}`);
            if (condCustom && cond.texto) {
              condCustom.value = cond.texto;
            }
            if (cond.atende) {
              const radio = document.querySelector(`input[name="cond_${index}"][value="${cond.atende}"]`);
              if (radio) radio.checked = true;
            }
          });
        }
        if (dados.checklist) {
          dados.checklist.forEach((item, index) => {
            if (item.atende) {
              const radio = document.querySelector(`input[name="check_${index}"][value="${item.atende}"]`);
              if (radio) radio.checked = true;
            }
          });
        }
        mostrarStatus('Dados carregados com sucesso!');
      } catch (e) {
        console.error('Erro ao carregar dados:', e);
        mostrarStatus('Erro ao carregar dados salvos', 'error');
      }
    }

    function gerarPDF() {
      try {
        mostrarStatus('Gerando PDF...', 'info');
        if (typeof window.jspdf === 'undefined') {
          mostrarStatus('Erro: Biblioteca jsPDF n√£o carregada', 'error');
          return;
        }
        const {
          jsPDF
        } = window.jspdf;
        const pdf = new jsPDF('p', 'mm', 'a4');
        const pageWidth = 210;
        const marginLeft = 20;
        const marginRight = 20;
        let yPos = 20;
        // Fun√ß√£o para adicionar cabe√ßalho com logos
        const adicionarCabecalho = () => {
          try {
            // Logo esquerda (ERCBA)
            if (LOGOS.headerLeft) {
              pdf.addImage(LOGOS.headerLeft, 'PNG', marginLeft, 10, 30, 23);
            } else {
              // Fallback se n√£o houver logo
              pdf.setFillColor(...PDF_CONFIG.colors.primary);
              pdf.rect(marginLeft, 10, 20, 20, 'F');
              pdf.setTextColor(255, 255, 255);
              pdf.setFontSize(8);
              pdf.text("ERCBA", marginLeft + 10, 22, {
                align: 'center'
              });
            }
            // Logo direita (IAT)
            if (LOGOS.headerRight) {
              pdf.addImage(LOGOS.headerRight, 'PNG', pageWidth - marginRight - 20, 10, 25, 20);
            } else {
              // Fallback se n√£o houver logo
              pdf.setFillColor(...PDF_CONFIG.colors.secondary);
              pdf.rect(pageWidth - marginRight - 20, 10, 20, 20, 'F');
              pdf.setTextColor(255, 255, 255);
              pdf.setFontSize(8);
              pdf.text("IAT", pageWidth - marginRight - 10, 22, {
                align: 'center'
              });
            }
          } catch (e) {
            console.log('Erro ao carregar logos, usando fallback:', e);
            // Fallback completo
            pdf.setFillColor(...PDF_CONFIG.colors.primary);
            pdf.rect(marginLeft, 10, 20, 20, 'F');
            pdf.setTextColor(255, 255, 255);
            pdf.setFontSize(8);
            pdf.text("ERCBA", marginLeft + 10, 22, {
              align: 'center'
            });
            pdf.setFillColor(...PDF_CONFIG.colors.secondary);
            pdf.rect(pageWidth - marginRight - 20, 10, 20, 20, 'F');
            pdf.text("IAT", pageWidth - marginRight - 10, 22, {
              align: 'center'
            });
          }
          pdf.setLineWidth(0.5);
          pdf.line(marginLeft, 35, pageWidth - marginRight, 35);
        };
        // Fun√ß√£o para adicionar rodap√©
        const adicionarRodape = (paginaAtual, totalPaginas) => {
          const hoje = new Date().toLocaleDateString('pt-BR');
          // Remover a linha antiga do rodap√©
          // pdf.line(marginLeft, 272, pageWidth - marginRight, 272); // Removido
          // Adicionar linha decorativa esticada
          if (LOGOS.footerLogo) {
            try {
              // Dimens√µes para a linha decorativa
              const lineWidth = pageWidth - marginLeft - marginRight; // Largura total da p√°gina menos margens
              const lineHeight = 2; // Altura da linha (mais fina)
              const lineY = 270; // Posi√ß√£o Y um pouco mais acima
              // Adicionar a imagem da linha esticada
              pdf.addImage(LOGOS.footerLogo, 'SVG', marginLeft, lineY, lineWidth, lineHeight);
            } catch (e) {
              console.log('Erro ao adicionar linha do rodap√©:', e);
              // Fallback: desenhar uma linha simples
              pdf.setLineWidth(0.5);
              pdf.setDrawColor(...PDF_CONFIG.colors.primary);
              pdf.line(marginLeft, 271, pageWidth - marginRight, 271);
            }
          } else {
            // Fallback: desenhar uma linha simples
            pdf.setLineWidth(0.5);
            pdf.setDrawColor(...PDF_CONFIG.colors.primary);
            pdf.line(marginLeft, 271, pageWidth - marginRight, 271);
          }
          // Texto do rodap√©
          pdf.setFontSize(7);
          pdf.setFont("helvetica", "normal");
          pdf.setTextColor(...PDF_CONFIG.colors.darkGray);
          // Ajustar posi√ß√£o do texto para ficar abaixo da linha
          pdf.text(PDF_CONFIG.footerText.linha1, marginLeft, 278);
          pdf.text(PDF_CONFIG.footerText.linha2, marginLeft, 282);
          pdf.text(PDF_CONFIG.footerText.linha3, marginLeft, 286);
          pdf.text(`Gerado em: ${hoje}`, pageWidth / 2, 286, {
            align: 'center'
          });
          pdf.text(`P√°gina ${paginaAtual} de ${totalPaginas}`, pageWidth - marginRight, 286, {
            align: 'right'
          });
        };
        // Fun√ß√£o para verificar nova p√°gina
        const verificarNovaPagina = (alturaNecessaria) => {
          if (yPos + alturaNecessaria > 250) {
            const paginaAtual = pdf.internal.getNumberOfPages();
            adicionarRodape(paginaAtual, paginaAtual + 1);
            pdf.addPage();
            adicionarCabecalho();
            yPos = 40;
            return true;
          }
          return false;
        };
        // Fun√ß√£o para adicionar cabe√ßalho da tabela de condicionantes
        const adicionarCabecalhoCondicionantes = (linhaY) => {
          pdf.setFillColor(...PDF_CONFIG.colors.primary);
          pdf.rect(marginLeft, linhaY, pageWidth - marginLeft - marginRight, 8, 'F');
          pdf.setTextColor(255, 255, 255);
          pdf.setFont("helvetica", "bold");
          pdf.setFontSize(9);
          pdf.text('CONDICIONANTES', marginLeft + 5, linhaY + 5);
          pdf.text('ATENDE', pageWidth - marginRight - 15, linhaY + 5);
          return linhaY + 8;
        };
        // Fun√ß√£o para adicionar cabe√ßalho da tabela de checklist
        const adicionarCabecalhoChecklist = (linhaY) => {
          pdf.setFillColor(...PDF_CONFIG.colors.secondary);
          pdf.rect(marginLeft, linhaY, pageWidth - marginLeft - marginRight, 8, 'F');
          pdf.setTextColor(255, 255, 255);
          pdf.setFont("helvetica", "bold");
          pdf.setFontSize(9);
          pdf.text('CHECK-LIST IN-LOCO', marginLeft + 5, linhaY + 5);
          pdf.text('ATENDE', pageWidth - marginRight - 15, linhaY + 5);
          return linhaY + 8;
        };
        // Come√ßar a primeira p√°gina
        adicionarCabecalho();
        yPos = 40;
        // T√≠tulo do relat√≥rio
        pdf.setFontSize(16);
        pdf.setFont("helvetica", "bold");
        pdf.setTextColor(...PDF_CONFIG.colors.primary);
        pdf.text(PDF_CONFIG.relatorioText.linha1, pageWidth / 2, yPos, {
          align: 'center'
        });
        yPos += 8;
        pdf.setFontSize(14);
        pdf.text(PDF_CONFIG.relatorioText.linha2, pageWidth / 2, yPos, {
          align: 'center'
        });
        yPos += 8;
        pdf.setFontSize(12);
        pdf.setTextColor(0, 0, 0);
        pdf.text(PDF_CONFIG.relatorioText.linha3, pageWidth / 2, yPos, {
          align: 'center'
        });
        yPos += 12;
        // Informa√ß√µes b√°sicas
        pdf.setFontSize(11);
        pdf.setFont("helvetica", "bold");
        pdf.setTextColor(...PDF_CONFIG.colors.primary);
        const empreendimento = document.getElementById('empreendimento').value || 'N√£o informado';
        const protocolo = document.getElementById('protocolo').value || 'N√£o informado';
        const dataVistoria = document.getElementById('dataVistoria').value || 'N√£o informada';
        pdf.text('EMPREENDIMENTO:', marginLeft, yPos);
        pdf.setFont("helvetica", "normal");
        pdf.setTextColor(0, 0, 0);
        pdf.text(empreendimento, marginLeft + 45, yPos);
        yPos += 7;
        pdf.setFont("helvetica", "bold");
        pdf.setTextColor(...PDF_CONFIG.colors.primary);
        pdf.text('PROTOCOLO:', marginLeft, yPos);
        pdf.setFont("helvetica", "normal");
        pdf.setTextColor(0, 0, 0);
        pdf.text(protocolo, marginLeft + 45, yPos);
        yPos += 7;
        pdf.setFont("helvetica", "bold");
        pdf.setTextColor(...PDF_CONFIG.colors.primary);
        pdf.text('DATA:', marginLeft, yPos);
        pdf.setFont("helvetica", "normal");
        pdf.setTextColor(0, 0, 0);
        pdf.text(dataVistoria, marginLeft + 45, yPos);
        yPos += 15;
        // Se√ß√£o 1: Condicionantes
        verificarNovaPagina(30);
        pdf.setFontSize(12);
        pdf.setFont("helvetica", "bold");
        pdf.setTextColor(...PDF_CONFIG.colors.primary);
        pdf.text('1. ATENDIMENTO √ÄS CONDICIONANTES:', marginLeft, yPos);
        yPos += 10;
        // Tabela de condicionantes
        let linhaY = yPos;
        // Cabe√ßalho da tabela
        linhaY = adicionarCabecalhoCondicionantes(linhaY);
        // Dados das condicionantes
        pdf.setFontSize(9);
        for (let i = 0; i < condicionantes.length; i++) {
          const condCustom = document.getElementById(`cond_custom_${i}`);
          let textoCond = '';
          if (condCustom && condCustom.value) {
            textoCond = condCustom.value;
          } else if (condicionantes[i]) {
            textoCond = condicionantes[i];
          }
          if (!textoCond.trim()) continue;
          // Verificar se precisa de nova p√°gina
          if (linhaY > 250) {
            const paginaAtual = pdf.internal.getNumberOfPages();
            adicionarRodape(paginaAtual, paginaAtual + 1);
            pdf.addPage();
            adicionarCabecalho();
            linhaY = 40;
            // Refazer cabe√ßalho da tabela
            linhaY = adicionarCabecalhoCondicionantes(linhaY);
            // Re-definir tamanho da fonte para o conte√∫do
            pdf.setFontSize(9);
          }
          const radioValue = document.querySelector(`input[name="cond_${i}"]:checked`)?.value;
          const atendeText = radioValue ? radioValue.toUpperCase() : 'N√ÉO';
          // Fundo zebrado
          if (i % 2 === 0) {
            pdf.setFillColor(...PDF_CONFIG.colors.lightGray);
            pdf.rect(marginLeft, linhaY, pageWidth - marginLeft - marginRight, 8, 'F');
          }
          pdf.setTextColor(0, 0, 0);
          pdf.setFont("helvetica", "normal");
          // Quebrar texto se necess√°rio
          const lines = pdf.splitTextToSize(textoCond, 120);
          for (let j = 0; j < lines.length; j++) {
            pdf.text(lines[j], marginLeft + 5, linhaY + (j * 4) + 4);
          }
          pdf.setFont("helvetica", "bold");
          pdf.text(atendeText, pageWidth - marginRight - 15, linhaY + 4);
          linhaY += Math.max(8, lines.length * 4);
        }
        yPos = linhaY + 10;
        // Se√ß√£o 2: Checklist
        verificarNovaPagina(30);
        pdf.setFontSize(12);
        pdf.setFont("helvetica", "bold");
        pdf.setTextColor(...PDF_CONFIG.colors.primary);
        pdf.text('2. RELAT√ìRIO DE CONFORMIDADE:', marginLeft, yPos);
        yPos += 10;
        // Tabela de checklist
        linhaY = yPos;
        // Cabe√ßalho da tabela
        linhaY = adicionarCabecalhoChecklist(linhaY);
        // Dados do checklist
        pdf.setFontSize(9);
        for (let i = 0; i < checklistItems.length; i++) {
          // Verificar se precisa de nova p√°gina
          if (linhaY > 250) {
            const paginaAtual = pdf.internal.getNumberOfPages();
            adicionarRodape(paginaAtual, paginaAtual + 1);
            pdf.addPage();
            adicionarCabecalho();
            linhaY = 40;
            // Refazer cabe√ßalho da tabela
            linhaY = adicionarCabecalhoChecklist(linhaY);
            // Re-definir tamanho da fonte para o conte√∫do
            pdf.setFontSize(9);
          }
          const item = checklistItems[i];
          const radioValue = document.querySelector(`input[name="check_${i}"]:checked`)?.value;
          const atendeText = radioValue ? radioValue.toUpperCase() : 'N√ÉO AVALIADO';
          // Fundo zebrado
          if (i % 2 === 0) {
            pdf.setFillColor(...PDF_CONFIG.colors.lightGray);
            pdf.rect(marginLeft, linhaY, pageWidth - marginLeft - marginRight, 8, 'F');
          }
          pdf.setTextColor(0, 0, 0);
          pdf.setFont("helvetica", "normal");
          // Quebrar texto se necess√°rio
          const lines = pdf.splitTextToSize(item, 120);
          for (let j = 0; j < lines.length; j++) {
            pdf.text(lines[j], marginLeft + 5, linhaY + (j * 4) + 4);
          }
          pdf.setFont("helvetica", "bold");
          pdf.text(atendeText, pageWidth - marginRight - 15, linhaY + 4);
          linhaY += Math.max(8, lines.length * 4);
        }
        yPos = linhaY + 15;
        // Observa√ß√µes
        const observacoes = document.getElementById('observacoes').value;
        if (observacoes && observacoes.trim()) {
          verificarNovaPagina(20);
          pdf.setFontSize(12);
          pdf.setFont("helvetica", "bold");
          pdf.setTextColor(...PDF_CONFIG.colors.primary);
          pdf.text('OBSERVA√á√ïES ADICIONAIS:', marginLeft, yPos);
          yPos += 8;
          pdf.setFontSize(10);
          pdf.setFont("helvetica", "normal");
          pdf.setTextColor(0, 0, 0);
          const obsLines = pdf.splitTextToSize(observacoes, pageWidth - 2 * marginLeft);
          for (let i = 0; i < obsLines.length; i++) {
            if (yPos > 250) {
              const paginaAtual = pdf.internal.getNumberOfPages();
              adicionarRodape(paginaAtual, paginaAtual + 1);
              pdf.addPage();
              adicionarCabecalho();
              yPos = 40;
            }
            pdf.text(obsLines[i], marginLeft, yPos);
            yPos += 5;
          }
        }
        // Assinatura
        verificarNovaPagina(40);
        yPos += 10;
        pdf.setFontSize(11);
        pdf.setFont("helvetica", "bold");
        pdf.setTextColor(...PDF_CONFIG.colors.primary);
        const vistoriador = document.getElementById('vistoriador').value || '________________';
        const cargo = document.getElementById('cargo').value || 'Engenheiro/Respons√°vel T√©cnico';
        pdf.text('VISTORIADOR: ' + vistoriador, marginLeft, yPos);
        yPos += 7;
        pdf.text('CARGO: ' + cargo, marginLeft, yPos);
        yPos += 15;
        // Linha de assinatura
        pdf.setLineWidth(0.5);
        pdf.line(marginLeft, yPos, marginLeft + 60, yPos);
        pdf.setFontSize(8);
        pdf.setTextColor(100, 100, 100);
        pdf.text('Assinatura', marginLeft + 20, yPos + 5);
        // Adicionar rodap√© em todas as p√°ginas
        const totalPaginas = pdf.internal.getNumberOfPages();
        for (let i = 1; i <= totalPaginas; i++) {
          pdf.setPage(i);
          adicionarRodape(i, totalPaginas);
        }
        // Salvar o PDF
        const nomeArquivo = protocolo ?
          `Relatorio_Vistoria_${protocolo.replace(/\s+/g, '_')}.pdf` :
          `Relatorio_Vistoria_${new Date().getTime()}.pdf`;
        pdf.save(nomeArquivo);
        mostrarStatus('PDF gerado com sucesso!');
      } catch (error) {
        console.error('Erro detalhado ao gerar PDF:', error);
        mostrarStatus(`Erro ao gerar PDF: ${error.message}`, 'error');
      }
    }

    function limparFormulario() {
      if (confirm('Tem certeza que deseja limpar todo o formul√°rio? Todos os dados ser√£o perdidos.')) {
        document.getElementById('formularioVistoria').reset();
        document.getElementById('dataVistoria').value = new Date().toISOString().split('T')[0];
        document.getElementById('cargo').value = 'Engenheiro/Respons√°vel T√©cnico';
        document.querySelectorAll('input[type="radio"]').forEach(radio => {
          radio.checked = false;
        });
        localStorage.removeItem('relatorioVistoria');
        mostrarStatus('Formul√°rio limpo com sucesso!');
      }
    }

    function mostrarStatus(mensagem, tipo = 'success') {
      const statusBar = document.getElementById('statusBar');
      statusBar.textContent = mensagem;
      statusBar.style.display = 'block';
      if (tipo === 'error') {
        statusBar.style.background = 'linear-gradient(135deg, #dc3545, #c82333)';
      } else if (tipo === 'info') {
        statusBar.style.background = 'linear-gradient(135deg, #17a2b8, #138496)';
      } else {
        statusBar.style.background = 'linear-gradient(135deg, var(--accent-color), #20c997)';
      }
      setTimeout(() => {
        statusBar.style.display = 'none';
      }, 3000);
    }
    // Auto-save a cada 30 segundos
    setInterval(() => {
      if (document.getElementById('empreendimento').value ||
        document.getElementById('protocolo').value) {
        salvarFormulario();
      }
    }, 30000);
    // Prevenir perda de dados ao sair
    window.addEventListener('beforeunload', function(e) {
      if (document.getElementById('empreendimento').value ||
        document.getElementById('protocolo').value) {
        salvarFormulario();
      }
    });
  </script>
</body>

</html>
